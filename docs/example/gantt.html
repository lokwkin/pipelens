
<!DOCTYPE html>
<html>
  <head>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script>
      google.charts.load("current", {packages:["gantt"]});
      google.charts.setOnLoadCallback(drawChart);

      function drawChart() {
        try {
          var container = document.getElementById('gantt_chart');
          var chart = new google.visualization.Gantt(container);
          var dataTable = new google.visualization.DataTable();

          // Add columns
          dataTable.addColumn('string', 'Task ID');
          dataTable.addColumn('string', 'Task Name');
          dataTable.addColumn('string', 'Resource');
          dataTable.addColumn('date', 'Start Date');
          dataTable.addColumn('date', 'End Date');
          dataTable.addColumn('number', 'Duration');
          dataTable.addColumn('number', 'Percent Complete');
          dataTable.addColumn('string', 'Dependencies');

          var steps = [{"key":"pipeline.parsing","startTs":246,"endTs":9127},{"key":"pipeline.parsing.preprocess","startTs":246,"endTs":1473},{"key":"pipeline.parsing.page_1","startTs":1912,"endTs":3775},{"key":"pipeline.parsing.page_2","startTs":1913,"endTs":6087},{"key":"pipeline.parsing.page_3","startTs":1913,"endTs":4238},{"key":"pipeline.parsing.page_4","startTs":1913,"endTs":5128},{"key":"pipeline.parsing.page_5","startTs":1913,"endTs":6567},{"key":"pipeline.parsing.page_6","startTs":1914,"endTs":5548},{"key":"pipeline.parsing.page_7","startTs":1914,"endTs":5449},{"key":"pipeline.parsing.page_8","startTs":1915,"endTs":6241},{"key":"pipeline.parsing.page_9","startTs":1915,"endTs":5634},{"key":"pipeline.parsing.page_10","startTs":1915,"endTs":5405},{"key":"pipeline.parsing.page_11","startTs":1915,"endTs":4599},{"key":"pipeline.parsing.page_12","startTs":1915,"endTs":5710},{"key":"pipeline.parsing.page_13","startTs":1915,"endTs":4691},{"key":"pipeline.parsing.page_14","startTs":1915,"endTs":6084},{"key":"pipeline.parsing.page_15","startTs":1915,"endTs":3036},{"key":"pipeline.parsing.page_16","startTs":1915,"endTs":6607},{"key":"pipeline.parsing.page_17","startTs":1915,"endTs":6893},{"key":"pipeline.parsing.page_18","startTs":1915,"endTs":2943},{"key":"pipeline.parsing.page_19","startTs":1915,"endTs":3127},{"key":"pipeline.parsing.page_20","startTs":1916,"endTs":5930},{"key":"pipeline.parsing.sample-error","startTs":6893,"endTs":9127}];
          
          // Compute the minimum start time to make timestamps relative
          var ganttStartTs = Number.MAX_SAFE_INTEGER;
          for (var i = 0; i < steps.length; i++) {
            ganttStartTs = Math.min(ganttStartTs, steps[i].startTs);
          }
          
          var rows = [];
          
          for (var i = 0; i < steps.length; i++) {
            var step = steps[i];
            
            // Create relative start time (milliseconds from the start of the first step)
            var relativeStartTs = step.startTs - ganttStartTs;
            
            // For the Gantt chart, use a base date (Jan 1, 1970) and add the relative time
            // This ensures the chart displays properly
            var startDate = new Date(relativeStartTs);
            var percentComplete;
            var duration = null;
            
            // Default to Success status
            var resource = 'Success';
            
            // Check for error (if there's an error property in your data)
            if (step.error) {
              resource = 'Error';
              percentComplete = 100; // Error is considered complete
              if (step.endTs && step.endTs > 0) {
                duration = step.endTs - step.startTs;
              }
            } 
            // Check if still running
            else if (step.endTs === 0 || !step.endTs) {
              resource = 'Running';
              percentComplete = 50; // In progress
              // For running tasks, set some arbitrary duration to show them on the chart
              duration = 1000; // 1 second placeholder
            } else {
              percentComplete = 100; // Completed successfully
              duration = step.endTs - step.startTs;
            }
            
            rows.push([
              step.key,           // Task ID
              step.key,           // Task Name
              resource,           // Resource (used for coloring)
              startDate,          // Start Date
              null,               // End Date (null when using duration)
              duration,           // Duration
              percentComplete,    // Percent Complete
              null                // Dependencies
            ]);
          }
          
          dataTable.addRows(rows);
          
          var options = {
            height: 575,
            gantt: {
              trackHeight: 30,
              barHeight: 20,
              labelMaxWidth: 300,
              criticalPathEnabled: false,
              percentEnabled: false,
              palette: [
                {
                  color: '#2e7d32', // Success - dark green
                  dark: '#1b5e20',  // Darker shade
                  light: '#e8f5e9'  // Light shade for hover
                },
                {
                  color: '#d32f2f', // Error - red
                  dark: '#b71c1c',
                  light: '#ffebee'
                },
                {
                  color: '#ed6c02', // Running - orange
                  dark: '#e65100',
                  light: '#fff3e0'
                }
              ]
            }
          };
          
          chart.draw(dataTable, options);
        } catch (err) {
          console.error('Error creating chart:', err);
          document.getElementById('gantt_chart').innerHTML = 
            '<div style="color: red; padding: 20px;">Error drawing chart: ' + err + '</div>';
        }
      }
    </script>
  </head>
  <body>
    <div id="gantt_chart" style="width: 100%; height: 575px;"></div>
  </body>
</html>
